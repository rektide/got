#!/usr/bin/env bash
set -e

XDG_GIT_DIR="${XDG_CONFIG_HOME:-$HOME/.config}/git"
GIT_CONFIG="$XDG_GIT_DIR/config"
CONFIG_D="$XDG_GIT_DIR/config.d"

mkdir -p "$CONFIG_D"

if [ ! -f "$GIT_CONFIG" ]; then
  echo "# Generated by git-config-d" > "$GIT_CONFIG"
fi

if grep -q "path = $CONFIG_D/\*.conf" "$GIT_CONFIG" 2>/dev/null; then
  echo "Include statement already present in $GIT_CONFIG"
else
  echo "" >> "$GIT_CONFIG"
  echo "[include]" >> "$GIT_CONFIG"
  echo "    path = $CONFIG_D/*.conf" >> "$GIT_CONFIG"
  echo "Added include statement to $GIT_CONFIG"
fi
